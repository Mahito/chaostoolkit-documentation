



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Chaos Toolkit">
      
      
      
        <meta name="author" content="The chaostoolkit Team">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.2, mkdocs-material-2.2.6">
    
    
      
        <title>Create a new Chaos Toolkit Extension with Custom Probes - Chaos Toolkit</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.6525f7f6.css">
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Chaos Toolkit" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Chaos Toolkit
              </span>
              <span class="md-header-nav__topic">
                Create a new Chaos Toolkit Extension with Custom Probes
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/chaostoolkit/chaostoolkit/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      chaostoolkit
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    Chaos Toolkit
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/chaostoolkit/chaostoolkit/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      chaostoolkit
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Overview
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Overview
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../overview/concepts/" title="Concepts" class="md-nav__link">
      Concepts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../faq/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Getting Started
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Getting Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../usage/install/" title="Install" class="md-nav__link">
      Install
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../usage/upgrade/" title="Upgrade" class="md-nav__link">
      Upgrade
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../usage/running/" title="Run" class="md-nav__link">
      Run
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../usage/latest/" title="Latest Release" class="md-nav__link">
      Latest Release
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../create-run-first-experiment/" title="Creating and Running your first Chaos Experiment" class="md-nav__link">
      Creating and Running your first Chaos Experiment
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Create a new Chaos Toolkit Extension with Custom Probes
      </label>
    
    <a href="./" title="Create a new Chaos Toolkit Extension with Custom Probes" class="md-nav__link md-nav__link--active">
      Create a new Chaos Toolkit Extension with Custom Probes
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introducing-the-extension" title="Introducing the Extension" class="md-nav__link">
    Introducing the Extension
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-new-extension-based-on-the-template-project" title="Creating a new Extension based on the Template project" class="md-nav__link">
    Creating a new Extension based on the Template project
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optional-create-a-virtual-environment-for-your-new-extension" title="(Optional) Create a virtual environment for your new extension" class="md-nav__link">
    (Optional) Create a virtual environment for your new extension
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-your-extensions-dependencies" title="Setup your extensions dependencies" class="md-nav__link">
    Setup your extensions dependencies
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-tests-for-the-new-probes" title="Create tests for the new probes" class="md-nav__link">
    Create tests for the new probes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-the-new-probes" title="Create the new Probes" class="md-nav__link">
    Create the new Probes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execute-the-tests" title="Execute the tests" class="md-nav__link">
    Execute the tests
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-your-new-probes" title="Using your new probes" class="md-nav__link">
    Using your new probes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" title="Next Steps" class="md-nav__link">
    Next Steps
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Project Overview
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Project Overview
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../project/values/" title="Key Project Values" class="md-nav__link">
      Key Project Values
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../project/core/" title="Core Projects" class="md-nav__link">
      Core Projects
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../project/extensions/" title="Extensions" class="md-nav__link">
      Extensions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../project/technologies/" title="Technology Choices" class="md-nav__link">
      Technology Choices
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Extending Chaos Toolkit
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Extending Chaos Toolkit
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../extending/approaches/" title="Extension Approaches" class="md-nav__link">
      Extension Approaches
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../extending/extending-with-python/" title="Python" class="md-nav__link">
      Python
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      API
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/experiment/" title="Experiment" class="md-nav__link">
      Experiment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/journal/" title="Journal" class="md-nav__link">
      Journal
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introducing-the-extension" title="Introducing the Extension" class="md-nav__link">
    Introducing the Extension
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-new-extension-based-on-the-template-project" title="Creating a new Extension based on the Template project" class="md-nav__link">
    Creating a new Extension based on the Template project
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optional-create-a-virtual-environment-for-your-new-extension" title="(Optional) Create a virtual environment for your new extension" class="md-nav__link">
    (Optional) Create a virtual environment for your new extension
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-your-extensions-dependencies" title="Setup your extensions dependencies" class="md-nav__link">
    Setup your extensions dependencies
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-tests-for-the-new-probes" title="Create tests for the new probes" class="md-nav__link">
    Create tests for the new probes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-the-new-probes" title="Create the new Probes" class="md-nav__link">
    Create the new Probes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execute-the-tests" title="Execute the tests" class="md-nav__link">
    Execute the tests
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-your-new-probes" title="Using your new probes" class="md-nav__link">
    Using your new probes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" title="Next Steps" class="md-nav__link">
    Next Steps
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/chaostoolkit/chaostoolkit/edit/master/docs/tutorials/custom-extension-probes.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="create-a-new-chaos-toolkit-extension-with-custom-probes">Create a new Chaos Toolkit Extension with Custom Probes<a class="headerlink" href="#create-a-new-chaos-toolkit-extension-with-custom-probes" title="Permanent link">&para;</a></h1>
<p>The Chaos Toolkit can be extended to observe specific information about your system, using probes, as well as provide custom actions that can be used from within your experiment&rsquo;s method. </p>
<p>In this tutorial you will learn how to create a new custom Python extension to the Chaos Toolkit to expose some custom probes in order to gather more data from the observability of your system. This is done so that you can customize how you specify your Steady State Hypothesis as well as providing a custom means of gathering additional data during your experiment execution.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The next tutorial in this series will show how to construct custom actions as well so that those can be used within your Chaos experiment&rsquo;s method.</p>
</div>
<h2 id="introducing-the-extension">Introducing the Extension<a class="headerlink" href="#introducing-the-extension" title="Permanent link">&para;</a></h2>
<p>The extension we are going to create here will be a simple integration with <a href="https://prometheus.io/">Prometheus</a> to provide a couple of new probes that we can use in our Chaos Engineering experiments. The probes will be:</p>
<ul>
<li><code>query</code> - Runs an instant query against a <a href="https://prometheus.io/">Prometheus</a> server and returns its result as-is.</li>
<li><code>query_interval</code> - Runs a range query against a <a href="https://prometheus.io/">Prometheus</a> server and returns its result as-is.</li>
</ul>
<p>The <code>query</code> probe will naturally, if specified with some tolerances, be a good candidate for use as part of a <a href="../../overview/concepts/#steady-state-hypothesis">Stead State Hypothesis</a> as well as a general-purpose probe.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There is already a <a href="https://github.com/chaostoolkit/chaostoolkit-prometheus">chaostoolkit-prometheus extension project</a> and the tutorial shown here is based on how it was originally developed.</p>
</div>
<h2 id="creating-a-new-extension-based-on-the-template-project">Creating a new Extension based on the Template project<a class="headerlink" href="#creating-a-new-extension-based-on-the-template-project" title="Permanent link">&para;</a></h2>
<p>To create a new project based on the Chaos Toolkit Extension Template grab the <a href="https://github.com/chaostoolkit/chaostoolkit-extension-template/releases/latest">latest released code for the template</a> and place this code in a new project that ideally follows the naming convention of <code>chaostoolkit-&lt;your extension name here&gt;</code>. </p>
<p>For our purposes we will create a new project based on the templates code called <code>chaostoolkit-prometheus</code>. You will also need to change any references to <code>chaosext</code> to the name of your new extension and its associated package. Once you have made those changes you should have a project contents that looks like the following:</p>
<div class="codehilite"><pre><span></span>.
├── CHANGELOG.md
├── LICENSE
├── MANIFEST.in
├── README.md
├── chaosprometheus
│   ├── __init__.py
│   └── probes.py
├── ci.bash
├── coverage.xml
├── junit-test-results.xml
├── pytest.ini
├── requirements-dev.txt
├── requirements.txt
├── setup.cfg
├── setup.py
└── tests
    └── test_probes.py
</pre></div>

<h2 id="optional-create-a-virtual-environment-for-your-new-extension">(Optional) Create a virtual environment for your new extension<a class="headerlink" href="#optional-create-a-virtual-environment-for-your-new-extension" title="Permanent link">&para;</a></h2>
<p>A Python virtual environment is a great way of managing your project&rsquo;s dependencies. We recommend creating a virtual environment for your new Chaos Toolkit extension project using the following command:</p>
<div class="codehilite"><pre><span></span>&gt; python3 -m venv ~/.venvs/&lt;your-ext-venv&gt;
</pre></div>

<h2 id="setup-your-extensions-dependencies">Setup your extensions dependencies<a class="headerlink" href="#setup-your-extensions-dependencies" title="Permanent link">&para;</a></h2>
<p>Now you can added dependencies into the <code>requirements-dev.txt</code>, for dependencies you only need at development time, and <code>requirements.txt</code>, for dependencies you only need at runtime. We need a few extra dependencies to work with Prometheus:</p>
<div class="codehilite"><pre><span></span>logzero
requests
dateparser
maya
</pre></div>

<p>Briefly, these dependencies are useful because they:</p>
<ul>
<li><code>logzero</code> - Makes it simpler to add logging to the Python extension. Also it is what the core Chaos Toolkit uses so this is consistent.</li>
<li><code>requests</code> - Adds an HTTP client for working against the Prometheus API</li>
<li><code>dateparser</code> - Provides support for manupulating dates and time, including generalinh time/date ranges.</li>
<li><code>maya</code> - Provides support for serialising dates and times to and from the dates and times needed for the Prometheus API.</li>
</ul>
<p>With those changes made you can now install your dependencies for your development work using the following command:</p>
<div class="codehilite"><pre><span></span>&gt; python setup.py develop
</pre></div>

<h2 id="create-tests-for-the-new-probes">Create tests for the new probes<a class="headerlink" href="#create-tests-for-the-new-probes" title="Permanent link">&para;</a></h2>
<p>You&rsquo;re now ready to start coding up your new probes for Prometheus. Using TDD, you can construct tests that exercise the success and failure scenarios of the expected probe functions in a <code>tests/test_probes.py</code> module:</p>
<div class="codehilite"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">requests_mock</span>

<span class="kn">from</span> <span class="nn">chaoslib.exceptions</span> <span class="kn">import</span> <span class="n">FailedActivity</span>
<span class="kn">from</span> <span class="nn">chaosprometheus.probes</span> <span class="kn">import</span> <span class="n">query</span><span class="p">,</span> <span class="n">query_interval</span>


<span class="k">def</span> <span class="nf">test_failed_parsing_when_date</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">FailedActivity</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">query</span><span class="p">(</span><span class="s2">&quot;request_processing_seconds_count&quot;</span><span class="p">,</span> <span class="n">when</span><span class="o">=</span><span class="s2">&quot;2 mns ago&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="s2">&quot;failed to parse &#39;2 mns ago&#39;&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_failed_parsing_start_date</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">FailedActivity</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">query_interval</span><span class="p">(</span><span class="s2">&quot;request_processing_seconds_count&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s2">&quot;2 mns ago&quot;</span><span class="p">,</span>
                       <span class="n">end</span><span class="o">=</span><span class="s2">&quot;now&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="s2">&quot;failed to parse &#39;2 mns ago&#39;&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_failed_parsing_end_date</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">FailedActivity</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">query_interval</span><span class="p">(</span><span class="s2">&quot;request_processing_seconds_count&quot;</span><span class="p">,</span>
                       <span class="n">start</span><span class="o">=</span><span class="s2">&quot;2 minutes ago&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;right now&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="s2">&quot;failed to parse &#39;right now&#39;&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_failed_running_query</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">requests_mock</span><span class="o">.</span><span class="n">mock</span><span class="p">()</span> <span class="k">as</span> <span class="n">m</span><span class="p">:</span>
        <span class="n">m</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;http://localhost:9090/api/v1/query_range&quot;</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Bad Request&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">FailedActivity</span><span class="p">)</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="n">query_interval</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="s2">&quot;request_processing_seconds_count&quot;</span><span class="p">,</span>
                           <span class="n">start</span><span class="o">=</span><span class="s2">&quot;2 minutes ago&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;now&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="s2">&quot;Prometheus query&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
</pre></div>

<h2 id="create-the-new-probes">Create the new Probes<a class="headerlink" href="#create-the-new-probes" title="Permanent link">&para;</a></h2>
<p>Finally it&rsquo;s time to create the new probes to meet the needs as specified by your tests in a file called <code>chaosprometheus/probes.py</code>:</p>
<div class="codehilite"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span>

<span class="kn">import</span> <span class="nn">dateparser</span>
<span class="kn">from</span> <span class="nn">logzero</span> <span class="kn">import</span> <span class="n">logger</span>
<span class="kn">import</span> <span class="nn">maya</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="kn">from</span> <span class="nn">chaoslib.exceptions</span> <span class="kn">import</span> <span class="n">FailedActivity</span>
<span class="kn">from</span> <span class="nn">chaoslib.types</span> <span class="kn">import</span> <span class="n">Configuration</span><span class="p">,</span> <span class="n">Secrets</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;query&quot;</span><span class="p">,</span> <span class="s2">&quot;query_interval&quot;</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">when</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
          <span class="n">configuration</span><span class="p">:</span> <span class="n">Configuration</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
          <span class="n">secrets</span><span class="p">:</span> <span class="n">Secrets</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run an instant query against a Prometheus server and returns its result</span>
<span class="sd">    as-is.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">base</span> <span class="o">=</span> <span class="p">(</span><span class="n">configuration</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="s2">&quot;prometheus_base_url&quot;</span><span class="p">,</span> <span class="s2">&quot;http://localhost:9090&quot;</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;{base}/api/v1/query&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="p">)</span>

    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;timeout&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timeout</span>

    <span class="k">if</span> <span class="n">when</span><span class="p">:</span>
        <span class="n">when_dt</span> <span class="o">=</span> <span class="n">dateparser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">when</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;RETURN_AS_TIMEZONE_AWARE&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">when_dt</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FailedActivity</span><span class="p">(</span><span class="s2">&quot;failed to parse &#39;{s}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">when</span><span class="p">))</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maya</span><span class="o">.</span><span class="n">MayaDT</span><span class="o">.</span><span class="n">from_datetime</span><span class="p">(</span><span class="n">when_dt</span><span class="p">)</span><span class="o">.</span><span class="n">rfc3339</span><span class="p">()</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Querying with: {q}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="n">params</span><span class="p">))</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">},</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">FailedActivity</span><span class="p">(</span>
            <span class="s2">&quot;Prometheus query {q} failed: {m}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="p">),</span> <span class="n">m</span><span class="o">=</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">query_interval</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                   <span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">configuration</span><span class="p">:</span> <span class="n">Configuration</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                   <span class="n">secrets</span><span class="p">:</span> <span class="n">Secrets</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run a range query against a Prometheus server and returns its result as-is.</span>

<span class="sd">    The `start` and `end` arguments can be a RFC 3339 date or expressed more</span>
<span class="sd">    colloquially such as `&quot;5 minutes ago&quot;`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">base</span> <span class="o">=</span> <span class="p">(</span><span class="n">configuration</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="s2">&quot;prometheus_base_url&quot;</span><span class="p">,</span> <span class="s2">&quot;http://localhost:9090&quot;</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;{base}/api/v1/query_range&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="p">)</span>

    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;timeout&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timeout</span>

    <span class="k">if</span> <span class="n">step</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;step&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">step</span>

    <span class="n">start_dt</span> <span class="o">=</span> <span class="n">dateparser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;RETURN_AS_TIMEZONE_AWARE&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">start_dt</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">FailedActivity</span><span class="p">(</span><span class="s2">&quot;failed to parse &#39;{s}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">start</span><span class="p">))</span>
    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maya</span><span class="o">.</span><span class="n">MayaDT</span><span class="o">.</span><span class="n">from_datetime</span><span class="p">(</span><span class="n">start_dt</span><span class="p">)</span><span class="o">.</span><span class="n">rfc3339</span><span class="p">()</span>

    <span class="n">end_dt</span> <span class="o">=</span> <span class="n">dateparser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;RETURN_AS_TIMEZONE_AWARE&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">end_dt</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">FailedActivity</span><span class="p">(</span><span class="s2">&quot;failed to parse &#39;{s}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">end</span><span class="p">))</span>
    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maya</span><span class="o">.</span><span class="n">MayaDT</span><span class="o">.</span><span class="n">from_datetime</span><span class="p">(</span><span class="n">end_dt</span><span class="p">)</span><span class="o">.</span><span class="n">rfc3339</span><span class="p">()</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Querying with: {q}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="n">params</span><span class="p">))</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">},</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">FailedActivity</span><span class="p">(</span>
            <span class="s2">&quot;Prometheus query range {q} failed: {m}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">q</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="p">),</span> <span class="n">m</span><span class="o">=</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</pre></div>

<h2 id="execute-the-tests">Execute the tests<a class="headerlink" href="#execute-the-tests" title="Permanent link">&para;</a></h2>
<p>With the implementations in place you can now run your tests to assert that everything is as expected:</p>
<div class="codehilite"><pre><span></span>&gt; pytest
</pre></div>

<p>And you should then get an output similar to the following:</p>
<div class="codehilite"><pre><span></span>&gt; pytest
Test session starts (platform: darwin, Python 3.6.2, pytest 3.3.0, pytest-sugar 0.9.0)
cachedir: .cache
rootdir: /Users/russellmiles/code/src/github.com/chaostoolkit/chaostoolkit-prometheus, inifile: pytest.ini
plugins: sugar-0.9.0, cov-2.5.1

 tests/test_probes.py::test_failed_parsing_when_date ✓                                                                                         25% ██▌       
 tests/test_probes.py::test_failed_parsing_start_date ✓                                                                                        50% █████     
 tests/test_probes.py::test_failed_parsing_end_date ✓                                                                                          75% ███████▌  
 tests/test_probes.py::test_failed_running_query ✓                                                                                            100% ██████████
------------------ generated xml file: /Users/russellmiles/code/src/github.com/chaostoolkit/chaostoolkit-prometheus/junit-test-results.xml ------------------

---------- coverage: platform darwin, python 3.6.2-final-0 -----------
Name                        Stmts   Miss  Cover   Missing
---------------------------------------------------------
chaosprometheus/probes.py      45      9    80%   29, 36-47, 66, 93
---------------------------------------------------------
TOTAL                          46      9    80%

1 file skipped due to complete coverage.
Coverage XML written to file coverage.xml


Results (3.64s):
       4 passed
</pre></div>

<h2 id="using-your-new-probes">Using your new probes<a class="headerlink" href="#using-your-new-probes" title="Permanent link">&para;</a></h2>
<p>That&rsquo;s all you need to do! You have now created your first Python-based extension to the Chaos Toolkit. You can now release and distribute this project using a system such as PyPi so that it can be installed and called from Chaos Toolkit experiments all over the world.</p>
<p>As an example, here is a snippet showing how a chaos experiment could look using your new <a href="https://prometheus.io/">Prometheus</a> <code>query</code> probe:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;probe&quot;</span><span class="p">,</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;fetch-cpu-just-2mn-ago&quot;</span><span class="p">,</span>
    <span class="nt">&quot;provider&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;python&quot;</span><span class="p">,</span>
        <span class="nt">&quot;module&quot;</span><span class="p">:</span> <span class="s2">&quot;chaosprometheus.probes&quot;</span><span class="p">,</span>
        <span class="nt">&quot;func&quot;</span><span class="p">:</span> <span class="s2">&quot;query&quot;</span><span class="p">,</span>
        <span class="nt">&quot;arguments&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;query&quot;</span><span class="p">:</span> <span class="s2">&quot;process_cpu_seconds_total{job=&#39;websvc&#39;}&quot;</span><span class="p">,</span>
            <span class="nt">&quot;when&quot;</span><span class="p">:</span> <span class="s2">&quot;2 minutes ago&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h2 id="next-steps">Next Steps<a class="headerlink" href="#next-steps" title="Permanent link">&para;</a></h2>
<p>In the next tutorial we will take a look at how to create an extension that includes actions that can be called to inject failure from your chaos experiments.</p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../create-run-first-experiment/" title="Creating and Running your first Chaos Experiment" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Creating and Running your first Chaos Experiment
              </span>
            </div>
          </a>
        
        
          <a href="../../project/values/" title="Key Project Values" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Key Project Values
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            &copy; 2017 chaostoolkit team
          </div>
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://github.com/chaostoolkit" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/chaostoolkit" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://join.chaostoolkit.org/" class="md-footer-social__link fa fa-slack"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.cae2244d.js"></script>
      
      <script>app.initialize({version:"0.17.2",url:{base:"../.."}})</script>
      
    
    
      
        <script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","UA-107338053-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})});var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})</script>
      
    
  </body>
</html>