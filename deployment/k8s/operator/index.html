



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Chaos Toolkit">
      
      
      
        <meta name="author" content="The Chaos Toolkit Team">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../static/images/favicon.ico">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-4.6.3">
    
    
      
        <title>Operator - Chaos Toolkit</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.adb8469c.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../../../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../static/css/extra.css">
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-107338053-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="yellow">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#deploy-chaos-toolkit-as-a-kubernetes-operator" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../.." title="Chaos Toolkit" aria-label="Chaos Toolkit" class="md-header-nav__button md-logo">
          
            <img alt="logo" src="../../../static/images/logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Chaos Toolkit
            </span>
            <span class="md-header-nav__topic">
              
                Operator
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/chaostoolkit/chaostoolkit/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    chaostoolkit
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../.." title="Chaos Toolkit" class="md-nav__button md-logo">
      
        <img alt="logo" src="../../../static/images/logo.png" width="48" height="48">
      
    </a>
    Chaos Toolkit
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/chaostoolkit/chaostoolkit/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    chaostoolkit
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Usage
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Usage
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/usage/install/" title="Install" class="md-nav__link">
      Install
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/usage/upgrade/" title="Upgrade" class="md-nav__link">
      Upgrade
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3">
    
    <label class="md-nav__link" for="nav-2-3">
      CLI
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        CLI
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/usage/cli/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/usage/discover/" title="Discover" class="md-nav__link">
      Discover
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/usage/init/" title="Init" class="md-nav__link">
      Init
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/usage/run/" title="Run" class="md-nav__link">
      Run
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/usage/report/" title="Report" class="md-nav__link">
      Report
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/usage/notification/" title="Notify" class="md-nav__link">
      Notify
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/usage/scheduling/" title="Schedule" class="md-nav__link">
      Schedule
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Deployment
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Deployment
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1" checked>
    
    <label class="md-nav__link" for="nav-3-1">
      Kubernetes
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-1">
        Kubernetes
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Operator
      </label>
    
    <a href="./" title="Operator" class="md-nav__link md-nav__link--active">
      Operator
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#deploy-the-operator" class="md-nav__link">
    Deploy the operator
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-an-experiment" class="md-nav__link">
    Run an experiment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manage-the-chaos-toolkit-experiments" class="md-nav__link">
    Manage the Chaos Toolkit Experiments
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#list-and-inspect-experiments" class="md-nav__link">
    List and inspect experiments
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-the-experiment-runs-resources" class="md-nav__link">
    Delete the experiment run's resources
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#various-configurations" class="md-nav__link">
    Various configurations
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configure-the-toolkit-with-environment-variables" class="md-nav__link">
    Configure the toolkit with environment variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handle-multiple-experiment-files" class="md-nav__link">
    Handle multiple experiment files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load-the-experiment-from-a-url" class="md-nav__link">
    Load the experiment from a URL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-experiments-in-another-namespace" class="md-nav__link">
    Run experiments in another namespace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pass-chaos-toolkit-settings-as-a-kubernetes-secret" class="md-nav__link">
    Pass Chaos Toolkit settings as a Kubernetes secret
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#keep-generated-resources-even-when-the-cro-is-deleted" class="md-nav__link">
    Keep generated resources even when the CRO is deleted
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pass-your-own-role-to-bind-to-the-service-account" class="md-nav__link">
    Pass your own role to bind to the service account
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#override-the-default-chaos-command-arguments" class="md-nav__link">
    Override the default chaos command arguments
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#label-your-chaos-toolkit-experiment" class="md-nav__link">
    Label your Chaos Toolkit experiment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#allow-network-traffic-for-chaos-toolkit-experiments" class="md-nav__link">
    Allow network traffic for Chaos Toolkit experiments
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-an-experiment-with-specific-extensions" class="md-nav__link">
    Run an experiment with specific extensions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#uninstall-the-operator" class="md-nav__link">
    Uninstall the operator
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/tutorial/" title="Get Started with the Chaos Toolkit" class="md-nav__link">
      Get Started with the Chaos Toolkit
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/tutorials/tolerance/" title="Learn all about Steady-State Tolerances" class="md-nav__link">
      Learn all about Steady-State Tolerances
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Drivers Reference
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Drivers Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../drivers/overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-2" type="checkbox" id="nav-5-2">
    
    <label class="md-nav__link" for="nav-5-2">
      Infrastructure/Platform
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-2">
        Infrastructure/Platform
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../drivers/aws/" title="AWS" class="md-nav__link">
      AWS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../drivers/azure/" title="Azure" class="md-nav__link">
      Azure
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../drivers/cloudfoundry/" title="Cloud Foundry" class="md-nav__link">
      Cloud Foundry
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../drivers/gandi/" title="Gandi" class="md-nav__link">
      Gandi
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../drivers/gcp/" title="Google Cloud Platform" class="md-nav__link">
      Google Cloud Platform
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../drivers/kubernetes/" title="Kubernetes" class="md-nav__link">
      Kubernetes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../drivers/service-fabric/" title="Service Fabric" class="md-nav__link">
      Service Fabric
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-3" type="checkbox" id="nav-5-3">
    
    <label class="md-nav__link" for="nav-5-3">
      Application
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-3">
        Application
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../drivers/spring/" title="Spring" class="md-nav__link">
      Spring
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-4" type="checkbox" id="nav-5-4">
    
    <label class="md-nav__link" for="nav-5-4">
      Network
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-4">
        Network
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../drivers/toxiproxy/" title="ToxiProxy" class="md-nav__link">
      ToxiProxy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../drivers/istio/" title="Istio" class="md-nav__link">
      Istio
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../drivers/wiremock/" title="WireMock" class="md-nav__link">
      WireMock
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-5" type="checkbox" id="nav-5-5">
    
    <label class="md-nav__link" for="nav-5-5">
      Observability
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-5">
        Observability
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../drivers/humio/" title="Humio" class="md-nav__link">
      Humio
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../drivers/prometheus/" title="Prometheus" class="md-nav__link">
      Prometheus
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../drivers/opentracing/" title="Open Tracing" class="md-nav__link">
      Open Tracing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Chaos Open API
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Chaos Open API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/concepts/" title="Concepts" class="md-nav__link">
      Concepts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/api/experiment/" title="Experiment" class="md-nav__link">
      Experiment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/api/journal/" title="Journal" class="md-nav__link">
      Journal
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Contribute
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Contribute
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/contributing/" title="Contributing to the Chaos Toolkit" class="md-nav__link">
      Contributing to the Chaos Toolkit
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-2" type="checkbox" id="nav-7-2">
    
    <label class="md-nav__link" for="nav-7-2">
      Project Management
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-2">
        Project Management
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/developing/values/" title="Key Project Values" class="md-nav__link">
      Key Project Values
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/developing/core/" title="Core Projects" class="md-nav__link">
      Core Projects
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/developing/technologies/" title="Technology Choices" class="md-nav__link">
      Technology Choices
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Develop
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Develop
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/developing/guidelines/" title="Guidelines" class="md-nav__link">
      Guidelines
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-2" type="checkbox" id="nav-8-2">
    
    <label class="md-nav__link" for="nav-8-2">
      Driver Extension
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-8-2">
        Driver Extension
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/extending/approaches/" title="Extension Approaches" class="md-nav__link">
      Extension Approaches
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/extending/extending-with-python/" title="Extend with Python" class="md-nav__link">
      Extend with Python
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-3" type="checkbox" id="nav-8-3">
    
    <label class="md-nav__link" for="nav-8-3">
      Control Extension
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-8-3">
        Control Extension
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../reference/extending/create-control-extension/" title="Create Control" class="md-nav__link">
      Create Control
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Resources
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Resources
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../resources/logos/" title="Logos" class="md-nav__link">
      Logos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../resources/slides/" title="Slides" class="md-nav__link">
      Slides
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#deploy-the-operator" class="md-nav__link">
    Deploy the operator
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-an-experiment" class="md-nav__link">
    Run an experiment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manage-the-chaos-toolkit-experiments" class="md-nav__link">
    Manage the Chaos Toolkit Experiments
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#list-and-inspect-experiments" class="md-nav__link">
    List and inspect experiments
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-the-experiment-runs-resources" class="md-nav__link">
    Delete the experiment run's resources
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#various-configurations" class="md-nav__link">
    Various configurations
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configure-the-toolkit-with-environment-variables" class="md-nav__link">
    Configure the toolkit with environment variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handle-multiple-experiment-files" class="md-nav__link">
    Handle multiple experiment files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load-the-experiment-from-a-url" class="md-nav__link">
    Load the experiment from a URL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-experiments-in-another-namespace" class="md-nav__link">
    Run experiments in another namespace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pass-chaos-toolkit-settings-as-a-kubernetes-secret" class="md-nav__link">
    Pass Chaos Toolkit settings as a Kubernetes secret
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#keep-generated-resources-even-when-the-cro-is-deleted" class="md-nav__link">
    Keep generated resources even when the CRO is deleted
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pass-your-own-role-to-bind-to-the-service-account" class="md-nav__link">
    Pass your own role to bind to the service account
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#override-the-default-chaos-command-arguments" class="md-nav__link">
    Override the default chaos command arguments
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#label-your-chaos-toolkit-experiment" class="md-nav__link">
    Label your Chaos Toolkit experiment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#allow-network-traffic-for-chaos-toolkit-experiments" class="md-nav__link">
    Allow network traffic for Chaos Toolkit experiments
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-an-experiment-with-specific-extensions" class="md-nav__link">
    Run an experiment with specific extensions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#uninstall-the-operator" class="md-nav__link">
    Uninstall the operator
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/chaostoolkit/chaostoolkit/edit/master/docs/deployment/k8s/operator.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="deploy-chaos-toolkit-as-a-kubernetes-operator">Deploy Chaos Toolkit as a Kubernetes Operator<a class="headerlink" href="#deploy-chaos-toolkit-as-a-kubernetes-operator" title="Permanent link">&para;</a></h1>
<p>Kubernetes operators are a popular approach to create bespoke controllers of
any application on top of the Kubernetes API.</p>
<p>The Chaos Toolkit operator listens for experiment declarations and triggers
a new Kubernetes pod, running the Chaos Toolkit with the specified experiment.</p>
<h2 id="deploy-the-operator">Deploy the operator<a class="headerlink" href="#deploy-the-operator" title="Permanent link">&para;</a></h2>
<p>The <a href="https://github.com/chaostoolkit-incubator/kubernetes-crd">operator</a> can be found on the Chaos Toolkit incubator.</p>
<p>It is deployed via typical Kubernetes <a href="https://github.com/chaostoolkit-incubator/kubernetes-crd/tree/master/manifests">manifests</a> which need to be applied
via <a href="https://kustomize.io/">Kustomize</a>, the native configuration manager.</p>
<p>First, download the <a href="https://github.com/kubernetes-sigs/kustomize/blob/master/docs/INSTALL.md">Kustomize binary</a>:</p>
<div class="codehilite"><pre><span></span><code>$ curl -s &quot;https://raw.githubusercontent.com/kubernetes-sigs/kustomize/master/hack/install_kustomize.sh&quot; | bash
</code></pre></div>

<p>For macOS, you can also install it via the Homebrew package manager: </p>
<div class="codehilite"><pre><span></span><code>$ brew install kustomize
</code></pre></div>

<p>Next, simply run the following:</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$</span> kustomize build manifests/overlays/generic-rbac <span class="p">|</span> kubectl apply -f -
</code></pre></div>

<p>This will build the manifests and apply them on your current default cluster.
Notice how we use the RBAC variant of the deployment. If you have other
requirements (no-RBAC, pod security or network policies), then check the
<a href="https://github.com/chaostoolkit-incubator/kubernetes-crd">operator&rsquo;s documentation</a> to deploy the appropriate variant.</p>
<p>You can install another variant as follows:</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$</span> kustomize build manifests/overlays/generic<span class="o">[</span>-rbac<span class="o">[</span>-podsec<span class="o">[</span>-netsec<span class="o">]]]</span> <span class="p">|</span> kubectl apply -f -
</code></pre></div>

<p>By now, you should have the operator running in the <code>chaostoolkit-crd</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$</span> kubectl -n chaostoolkit-crd get pods
<span class="go">NAME                                READY   STATUS    RESTARTS   AGE</span>
<span class="go">chaostoolkit-crd-7ddb9b78d9-dgxx7   1/1     Running   0          35s</span>
</code></pre></div>

<p>The operator deployment created two namespaces, by default:
- the <code>chaostoolkit-crd</code> namespace contains the operator pod and Chaos Toolkit
 experiment definitions 
- the <code>chaostoolkit-run</code> namespace contains pods running the Chaos Toolkit
 experiments</p>
<h2 id="run-an-experiment">Run an experiment<a class="headerlink" href="#run-an-experiment" title="Permanent link">&para;</a></h2>
<p>Now that your controller is listening, you can ask it to schedule a Chaos
Toolkit experiment by applying a resource with the following API:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit.org/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ChaosToolkitExperiment</span>
</code></pre></div>

<p>Below is a basic example, assuming a file named <code>basic.yaml</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-experiment</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-run</span>
<span class="nt">data</span><span class="p">:</span>
  <span class="nt">experiment.json</span><span class="p">:</span> <span class="p p-Indicator">|</span>
    <span class="no">{</span>
      <span class="no">&quot;version&quot;: &quot;1.0.0&quot;,</span>
      <span class="no">&quot;title&quot;: &quot;Hello world!&quot;,</span>
      <span class="no">&quot;description&quot;: &quot;Say hello world.&quot;,</span>
      <span class="no">&quot;method&quot;: [</span>
        <span class="no">{</span>
          <span class="no">&quot;type&quot;: &quot;action&quot;,</span>
          <span class="no">&quot;name&quot;: &quot;say-hello&quot;,</span>
          <span class="no">&quot;provider&quot;: {</span>
            <span class="no">&quot;type&quot;: &quot;process&quot;,</span>
            <span class="no">&quot;path&quot;: &quot;echo&quot;,</span>
            <span class="no">&quot;arguments&quot;: &quot;hello&quot;</span>
          <span class="no">}</span>
        <span class="no">}</span>
      <span class="no">]</span>
    <span class="no">}</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit.org/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ChaosToolkitExperiment</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-chaos-exp</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-crd</span>
</code></pre></div>

<p>First, we will use the default namespace in which the Chaos Toolkit will run.</p>
<p>Then, we need a config map to pass the experiment to execute.</p>
<p>Finally, we simply create a <code>ChaosToolkitExperiment</code> object that the
controller picks up and understand as a new experiment to run in its own pod.</p>
<p>Apply it as follows:</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$</span> kubectl apply -f basic.yaml
</code></pre></div>

<p>Then, you can check the Chaos Toolkit experiment has been registered, and will
be scheduled to run as soon as possible:</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$</span> kubectl -n chaostoolkit-crd get ctks
</code></pre></div>

<p>Look at the Chaos Toolkit running:</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$</span> kubectl -n chaostoolkit-run get pods
</code></pre></div>

<p>The status of the experiment&rsquo;s run, if it deviated, defines the status
if the pod. So, when the experiment does deviate, the pod should have a
status set to <code>Error</code>. Otherwise, the status will be <code>Completed</code>.</p>
<h2 id="manage-the-chaos-toolkit-experiments">Manage the Chaos Toolkit Experiments<a class="headerlink" href="#manage-the-chaos-toolkit-experiments" title="Permanent link">&para;</a></h2>
<h3 id="list-and-inspect-experiments">List and inspect experiments<a class="headerlink" href="#list-and-inspect-experiments" title="Permanent link">&para;</a></h3>
<p>You can list your experiments as follows:</p>
<div class="codehilite"><pre><span></span><code>$ kubectl -n chaostoolkit-crd get chaosexperiments 
</code></pre></div>

<p>You can describe one experiment as follows:</p>
<div class="codehilite"><pre><span></span><code>$ kubectl -n chaostoolkit-crd describe chaosexperiment my-chaos-exp 
</code></pre></div>

<p>You can also use the short names for the custom resource <code>ctks</code> and <code>ctk</code>.</p>
<h3 id="delete-the-experiment-runs-resources">Delete the experiment run&rsquo;s resources<a class="headerlink" href="#delete-the-experiment-runs-resources" title="Permanent link">&para;</a></h3>
<p>You can delete an experiment and its related resources as follows:</p>
<div class="codehilite"><pre><span></span><code>$ kubectl -n chaostoolkit-crd delete ctk my-chaos-exp 
</code></pre></div>

<p>However, the custom resources (ConfigMap, Secrets, etc.) won&rsquo;t be deleted. 
This command only deletes the resources that the operator creates for the 
experiment to be able to run.</p>
<p>To delete all the run&rsquo;s resources, simply delete the objects as follows:</p>
<div class="codehilite"><pre><span></span><code>$ kubectl delete -f basic.yaml
</code></pre></div>

<h2 id="various-configurations">Various configurations<a class="headerlink" href="#various-configurations" title="Permanent link">&para;</a></h2>
<p>You may decide to change various aspects of the final pod (such as passing
settings as secrets, changing the roles allowed to the pod, even override
the entire pod template).</p>
<h3 id="configure-the-toolkit-with-environment-variables">Configure the toolkit with environment variables<a class="headerlink" href="#configure-the-toolkit-with-environment-variables" title="Permanent link">&para;</a></h3>
<p>Chaos Toolkit experiments often expect data to be passed as environment
variables of the <code>chaos</code>&lsquo;s command shell.</p>
<p>The operator allows you to specify those values through the config map
as we saw above:</p>
<div class="codehilite"><pre><span></span><code><span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-env</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-run</span>
<span class="nt">data</span><span class="p">:</span>
  <span class="nt">NAME</span><span class="p">:</span> <span class="s">&quot;Jane</span><span class="nv"> </span><span class="s">Doe&quot;</span>
</code></pre></div>

<p>They will be injected into the Chaos Toolkit&rsquo;s pod as environment variables.</p>
<p>You might need several environment config maps for various experiments. You can
tell the operator where to find the config map to be loaded as environment
variables.</p>
<p>We&rsquo;ll assume you defined another config map named <code>my-chaos-env-vars</code>. You
can use it by setting the <code>configMapName</code> in the <code>env</code> block of the pod spec: </p>
<div class="codehilite"><pre><span></span><code><span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit.org/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ChaosToolkitExperiment</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-chaos-exp</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-crd</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">pod</span><span class="p">:</span>
    <span class="nt">env</span><span class="p">:</span>
      <span class="nt">configMapName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-chaos-env-vars</span>
</code></pre></div>

<h3 id="handle-multiple-experiment-files">Handle multiple experiment files<a class="headerlink" href="#handle-multiple-experiment-files" title="Permanent link">&para;</a></h3>
<p>In the basic example, the name of the config map holding the experiment 
is the default value <code>chaostoolkit-experiment</code>. Usually, you&rsquo;ll want a more
unique name since you&rsquo;ll probably run multiple experiments from the
<code>chaostoolkit-run</code> namespace.</p>
<p>In that case, do it as follows:</p>
<div class="codehilite"><pre><span></span><code><span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-experiment-1234</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-run</span>
<span class="nt">data</span><span class="p">:</span>
  <span class="nt">experiment.json</span><span class="p">:</span> <span class="p p-Indicator">|</span>
    <span class="no">{</span>
        <span class="no">&quot;title&quot;: &quot;...&quot;,</span>
    <span class="no">}</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit.org/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ChaosToolkitExperiment</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-chaos-exp</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-crd</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">pod</span><span class="p">:</span>
    <span class="nt">experiment</span><span class="p">:</span>
      <span class="nt">configMapName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-experiment-1234</span>
</code></pre></div>

<p>You need to define the <code>configMapName</code> in the <code>experiment</code> block of 
the pod spec. </p>
<h3 id="load-the-experiment-from-a-url">Load the experiment from a URL<a class="headerlink" href="#load-the-experiment-from-a-url" title="Permanent link">&para;</a></h3>
<p>By default, the experiment is read from a file. But you may store it remotely
e.g. GitHub and have it available over HTTP. You might want to load it from
its remote URL instead.</p>
<p>You can tell the Chaos Toolkit to load it from a remote URL rather than from
a local file, as follows:</p>
<div class="codehilite"><pre><span></span><code><span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-env</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-run</span>
<span class="nt">data</span><span class="p">:</span>
  <span class="nt">EXPERIMENT_URL</span><span class="p">:</span> <span class="s">&quot;https://example.com/experiment.json&quot;</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit.org/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ChaosToolkitExperiment</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-chaos-exp</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-crd</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">pod</span><span class="p">:</span>
    <span class="nt">experiment</span><span class="p">:</span>
      <span class="nt">asFile</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
</code></pre></div>

<p>First, you need to pass the <code>EXPERIMENT_URL</code> environment variable.</p>
<p>Then, tell the operator not to mount the default experiment volume. To do so,
you need to set <code>asFile</code> to <code>false</code> in the <code>experiment</code> block of the pod spec.</p>
<h3 id="run-experiments-in-another-namespace">Run experiments in another namespace<a class="headerlink" href="#run-experiments-in-another-namespace" title="Permanent link">&para;</a></h3>
<p>You may create the namespace in which the resources will be deployed:</p>
<div class="codehilite"><pre><span></span><code><span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit.org/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ChaosToolkitExperiment</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-chaos-exp</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-crd</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-other-namespace</span>
</code></pre></div>

<p>You need to defined the <code>namespace</code> value at the spec level.</p>
<p>If the namespace already exists, a message will be logged but this will not
abort the operation.</p>
<p>However, this namespace will be entirely under your responsibility. No network
nor pod securities will be managed in your namespace, if the operator was 
installed with those variants. You&rsquo;ll need to manage them yourself.  </p>
<h3 id="pass-chaos-toolkit-settings-as-a-kubernetes-secret">Pass Chaos Toolkit settings as a Kubernetes secret<a class="headerlink" href="#pass-chaos-toolkit-settings-as-a-kubernetes-secret" title="Permanent link">&para;</a></h3>
<p>Chaos Toolkit reads its settings from a file and you can pass yours
by creating a Kubernetes secret named, by default, <code>chaostoolkit-settings</code>.</p>
<p>For instance, assuming you have a <a href="../../../reference/usage/settings/">Chaos Toolkit settings file</a>,
you can create a secret from it as follows:</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$</span> kubectl -n chaostoolkit-run <span class="se">\</span>
    create secret generic chaostoolkit-settings <span class="se">\</span>
    --from-file<span class="o">=</span>settings.yaml<span class="o">=</span>./settings.yaml
</code></pre></div>

<p>Note, the settings file must be named as <code>settings.yaml</code> within the secret.</p>
<p>Reading settings is disabled by default, so you need to let the operator
know it should allow it for that run:</p>
<div class="codehilite"><pre><span></span><code><span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit.org/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ChaosToolkitExperiment</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-chaos-exp</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-crd</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-run</span>
  <span class="nt">pod</span><span class="p">:</span>
    <span class="nt">settings</span><span class="p">:</span>
      <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>

<p>You need to set the variable <code>enabled</code> to <code>true</code>in the <code>settings</code>block of the 
pod spec.</p>
<p>The default name for that secret is <code>chaostoolkit-settings</code> but you can change
it with the <code>secretName</code> variable, as follows:</p>
<div class="codehilite"><pre><span></span><code><span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit.org/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ChaosToolkitExperiment</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-chaos-exp</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-crd</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-run</span>
  <span class="nt">pod</span><span class="p">:</span>
    <span class="nt">settings</span><span class="p">:</span>
      <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
      <span class="nt">secretName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-super-secret</span>
</code></pre></div>

<h3 id="keep-generated-resources-even-when-the-cro-is-deleted">Keep generated resources even when the CRO is deleted<a class="headerlink" href="#keep-generated-resources-even-when-the-cro-is-deleted" title="Permanent link">&para;</a></h3>
<p>When you delete the <code>ChaosToolkitExperiment</code> resource, all the allocated
resources are deleted too (pod, service account, &hellip;). To prevent this, you may
set the <code>keep_resources_on_delete</code> property to <code>true</code> at the spec level. </p>
<div class="codehilite"><pre><span></span><code><span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit.org/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ChaosToolkitExperiment</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-chaos-exp</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-crd</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-run</span>
  <span class="nt">keep_resources_on_delete</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>

<p>In that case, you are responsible to cleanup all resources.</p>
<h3 id="pass-your-own-role-to-bind-to-the-service-account">Pass your own role to bind to the service account<a class="headerlink" href="#pass-your-own-role-to-bind-to-the-service-account" title="Permanent link">&para;</a></h3>
<p>If your cluster has enabled RBAC, then the operator automatically binds a basic
role to the service account associated with the chaostoolkit pod. That role
allows your experiment to create/get/list/delete other pods in the same
namespace.</p>
<p>You probably have more specific requirements, here is how to do it:</p>
<div class="codehilite"><pre><span></span><code><span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit.org/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ChaosToolkitExperiment</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-chaos-exp</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-crd</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-run</span>
  <span class="nt">role</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-role</span>
</code></pre></div>

<p>The property <code>name</code> should be set to the name of the role you have created in
the namespace which the experiment is executed in. The service account
associated with the pod will be bound to that role.</p>
<h3 id="override-the-default-chaos-command-arguments">Override the default chaos command arguments<a class="headerlink" href="#override-the-default-chaos-command-arguments" title="Permanent link">&para;</a></h3>
<p>The pod template executes the <code>chaos run</code> command by default. You may want to
extends or change the sub-command to execute when running the pod. You can
define the <code>chaos</code> arguments as follow:</p>
<div class="codehilite"><pre><span></span><code><span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit.org/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ChaosToolkitExperiment</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-chaos-exp</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-crd</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-run</span>
  <span class="nt">pod</span><span class="p">:</span>
    <span class="nt">chaosArgs</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--verbose</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">run</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--dry</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">${EXPERIMENT_PATH-$EXPERIMENT_URL}</span>
</code></pre></div>

<p>You need to set the list of arguments in the <code>chaosArgs</code> variable at pod 
spec level.</p>
<h3 id="label-your-chaos-toolkit-experiment">Label your Chaos Toolkit experiment<a class="headerlink" href="#label-your-chaos-toolkit-experiment" title="Permanent link">&para;</a></h3>
<p>Experiment labels can be defined in the <code>ChaosToolkitExperiment</code>&lsquo;s metadata.
All labels will be forwarded, if not already defined, in the pod running the
experiment.</p>
<p>You can define labels as follow:</p>
<div class="codehilite"><pre><span></span><code><span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit.org/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ChaosToolkitExperiment</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-chaos-exp</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-crd</span>
  <span class="nt">labels</span><span class="p">:</span>
    <span class="nt">environment</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">staging</span>
    <span class="nt">tier</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">backend</span>
    <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">database</span>
</code></pre></div>

<p>These labels can then be used as selectors.</p>
<h3 id="allow-network-traffic-for-chaos-toolkit-experiments">Allow network traffic for Chaos Toolkit experiments<a class="headerlink" href="#allow-network-traffic-for-chaos-toolkit-experiments" title="Permanent link">&para;</a></h3>
<p>When the operator is installed with the network security variant, the
<code>chaostoolkit</code> pod has limited network access. The pod is, by default,
isolated for ingress connectivity and is limited to only DNS lookup &amp;
HTTPS for external traffic.</p>
<p>To allow the pod for other access, you may create another network policy
within the <code>chaostoolkit-run</code> namespace for pods matching the 
<code>app: chaostoolkit</code> label:</p>
<div class="codehilite"><pre><span></span><code><span class="nn">---</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">NetworkPolicy</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-custom-network-policy</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-run</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">podSelector</span><span class="p">:</span>
    <span class="nt">matchLabels</span><span class="p">:</span>
      <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit</span>
</code></pre></div>

<h2 id="run-an-experiment-with-specific-extensions">Run an experiment with specific extensions<a class="headerlink" href="#run-an-experiment-with-specific-extensions" title="Permanent link">&para;</a></h2>
<p>The default container image used by the operator is the official 
<a href="https://raw.githubusercontent.com/chaostoolkit/chaostoolkit/master/Dockerfile">Chaos Toollkit image</a> which embeds no
<a href="../../../drivers/overview/">Chaos Toolkit extensions</a>.</p>
<p>This means that you will likely need to create your bespoke container image.
For instance, to install the Chaos Toolkit Kubernetes extension, create
a Dockerfile like this:</p>
<div class="codehilite"><pre><span></span><code><span class="k">FROM</span> <span class="s">chaostoolkit/chaostoolkit</span>

<span class="k">RUN</span> apk update <span class="o">&amp;&amp;</span> <span class="se">\</span>
    apk add --virtual build-deps libffi-dev openssl-dev gcc python3-dev musl-dev <span class="o">&amp;&amp;</span> <span class="se">\</span>
    pip install --no-cache-dir chaostoolkit-kubernetes <span class="o">&amp;&amp;</span> <span class="se">\</span>
    apk del build-deps
</code></pre></div>

<p>Then create the image with docker:</p>
<div class="codehilite"><pre><span></span><code>$ docker build --tag my/chaostoolkit -f ./Dockerfile .
</code></pre></div>

<p>or, something such as <a href="https://podman.io/">Podman</a>:</p>
<div class="codehilite"><pre><span></span><code>$ podman build --tag my/chaostoolkit -f ./Dockerfile
</code></pre></div>

<p>You can check your image contains the installed extensions as follows:</p>
<div class="codehilite"><pre><span></span><code>$ docker run --rm -it my/chaostoolkit info extensions
</code></pre></div>

<p>Once this image is pushed to any registry you can access, you need to
let the operator know it must use it.</p>
<div class="codehilite"><pre><span></span><code><span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit.org/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ChaosToolkitExperiment</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my-chaos-exp</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-crd</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chaostoolkit-run</span>
  <span class="nt">pod</span><span class="p">:</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my/chaostoolkit</span>
</code></pre></div>

<h2 id="uninstall-the-operator">Uninstall the operator<a class="headerlink" href="#uninstall-the-operator" title="Permanent link">&para;</a></h2>
<p>To uninstall the operator and its own resources, simply run the following
command for the overlay that is deployed.</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$</span> kustomize build manifests/overlays/generic<span class="o">[</span>-rbac<span class="o">[</span>-podsec<span class="o">[</span>-netsec<span class="o">]]]</span> <span class="p">|</span> kubectl delete -f -
</code></pre></div>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../../reference/usage/scheduling/" title="Schedule" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Schedule
              </span>
            </div>
          </a>
        
        
          <a href="../../../reference/tutorial/" title="Get Started with the Chaos Toolkit" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Get Started with the Chaos Toolkit
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            &copy; 2017-2018 chaostoolkit team
          </div>
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/chaostoolkit" target="_blank" rel="noopener" title="github" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/chaostoolkit" target="_blank" rel="noopener" title="twitter" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://join.chaostoolkit.org/" target="_blank" rel="noopener" title="slack" class="md-footer-social__link fa fa-slack"></a>
    
      <a href="https://medium.com/chaos-toolkit" target="_blank" rel="noopener" title="medium" class="md-footer-social__link fa fa-medium"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.1",url:{base:"../../.."}})</script>
      
    
  </body>
</html>