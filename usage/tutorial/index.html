



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Chaos Toolkit">
      
      
      
        <meta name="author" content="The chaostoolkit Team">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.2, mkdocs-material-2.2.3">
    
    
      
        <title>Tutorials - Chaos Toolkit</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.bcabdff3.css">
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Chaos Toolkit" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Chaos Toolkit
              </span>
              <span class="md-header-nav__topic">
                Tutorials
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/chaostoolkit/chaostoolkit/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      chaostoolkit
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    Chaos Toolkit
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/chaostoolkit/chaostoolkit/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      chaostoolkit
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Overview
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Overview
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../overview/concepts/" title="Concepts" class="md-nav__link">
      Concepts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../faq/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Getting Started
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Getting Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../install/" title="Install" class="md-nav__link">
      Install
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../upgrade/" title="Upgrade" class="md-nav__link">
      Upgrade
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../running/" title="Run" class="md-nav__link">
      Run
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Tutorials
      </label>
    
    <a href="./" title="Tutorials" class="md-nav__link md-nav__link--active">
      Tutorials
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#create-your-first-experiment" title="Create your first Experiment" class="md-nav__link">
    Create your first Experiment
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#define-your-hypothesis" title="Define your hypothesis" class="md-nav__link">
    Define your hypothesis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-the-requirements" title="Get the requirements" class="md-nav__link">
    Get the requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-first-experiment-a-missing-file" title="A first experiment: a missing file" class="md-nav__link">
    A first experiment: a missing file
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#declare-your-experiment" title="Declare your experiment" class="md-nav__link">
    Declare your experiment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-your-experiment" title="Run your experiment" class="md-nav__link">
    Run your experiment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fix-your-service" title="Fix your service" class="md-nav__link">
    Fix your service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-your-experiment-again" title="Run your experiment again" class="md-nav__link">
    Run your experiment again
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#go-further" title="Go further" class="md-nav__link">
    Go further
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../latest/" title="Latest Release" class="md-nav__link">
      Latest Release
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Technology
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Technology
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../technology/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../technology/extend/" title="Extend" class="md-nav__link">
      Extend
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      API
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/experiment/" title="Experiment" class="md-nav__link">
      Experiment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/journal/" title="Journal" class="md-nav__link">
      Journal
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#create-your-first-experiment" title="Create your first Experiment" class="md-nav__link">
    Create your first Experiment
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#define-your-hypothesis" title="Define your hypothesis" class="md-nav__link">
    Define your hypothesis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-the-requirements" title="Get the requirements" class="md-nav__link">
    Get the requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-first-experiment-a-missing-file" title="A first experiment: a missing file" class="md-nav__link">
    A first experiment: a missing file
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#declare-your-experiment" title="Declare your experiment" class="md-nav__link">
    Declare your experiment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-your-experiment" title="Run your experiment" class="md-nav__link">
    Run your experiment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fix-your-service" title="Fix your service" class="md-nav__link">
    Fix your service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-your-experiment-again" title="Run your experiment again" class="md-nav__link">
    Run your experiment again
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#go-further" title="Go further" class="md-nav__link">
    Go further
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/chaostoolkit/chaostoolkit/edit/master/docs/usage/tutorial.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Tutorials</h1>
                
                <h2 id="create-your-first-experiment">Create your first Experiment<a class="headerlink" href="#create-your-first-experiment" title="Permanent link">&para;</a></h2>
<p>This walkthrough will drive you the basics of writing your very first
experiment.</p>
<h3 id="define-your-hypothesis">Define your hypothesis<a class="headerlink" href="#define-your-hypothesis" title="Permanent link">&para;</a></h3>
<p>Before you start writing code, you need to define your hypthesis. What is it
you are trying to confirm or infirm?</p>
<p>There are various ways to come up with an hypothesis:</p>
<ul>
<li>a real scenario that you and your team did not fully get a chance to learn
  from while in emergency mode. Retrospective sessions in agile teams may be
  a great starting point</li>
<li><a href="https://www.impactmapping.org/">impact mapping</a> is another strategy to let the team bubble
  up relevant scenarios</li>
<li>your existing disaster recovery playbooks could be turned into experiments
  that are actively applied against the system</li>
</ul>
<p>However you come up with your hypothesis, make sure you can analyse the 
result so keep its scope and objective simple and comprehensible.</p>
<h3 id="get-the-requirements">Get the requirements<a class="headerlink" href="#get-the-requirements" title="Permanent link">&para;</a></h3>
<p>Often, an experiment involves fairly specific access to observe or interact
with the system. Make sure you can gather the right permissions and people on
board.</p>
<h3 id="a-first-experiment-a-missing-file">A first experiment: a missing file<a class="headerlink" href="#a-first-experiment-a-missing-file" title="Permanent link">&para;</a></h3>
<p>Let&rsquo;s say we have a service that polls a local file every second to see if new
content was added for processing. Development made the assumption the file
would always be there and did not write a failure code path.</p>
<p>Our hypothesis is that the service should not break but simply try again until
the file comes back. </p>
<p>Our experiment should try that hypothesis to see where our system stands.</p>
<p>Below is the code of our service as it is now:</p>
<div class="codehilite"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">from</span> <span class="nn">wsgiref.validate</span> <span class="kn">import</span> <span class="n">validator</span>
<span class="kn">from</span> <span class="nn">wsgiref.simple_server</span> <span class="kn">import</span> <span class="n">make_server</span>

<span class="n">EXCHANGE_FILE</span> <span class="o">=</span> <span class="s2">&quot;./exchange.dat&quot;</span>


<span class="k">def</span> <span class="nf">update_exchange_file</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes the current date and time every 10 seconds into the exchange file.</span>

<span class="sd">    The file is created if it does not exist.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Will update to exchange file&quot;</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">EXCHANGE_FILE</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">())</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">simple_app</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read the content of the exchange file and return it.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start_response</span><span class="p">(</span><span class="s1">&#39;200 OK&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">)])</span>
    <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">EXCHANGE_FILE</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)]</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">update_exchange_file</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="n">httpd</span> <span class="o">=</span> <span class="n">make_server</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">,</span> <span class="n">simple_app</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Listening on port 8080....&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">httpd</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="n">httpd</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
        <span class="n">t</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

<p>The code is simple for the purpose of this tutorial. As you can see, we declare
a simple function that reads a file and returns its content when called.</p>
<p>A background thread function writes the current data to that file every 10
seconds.</p>
<p>Notice how we do not check the file exists before reading it soo it is likely
this can fail.</p>
<p>Run this service from another terminal as follows:</p>
<div class="codehilite"><pre><span></span>$ python service.py
</pre></div>

<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The <a href="https://github.com/chaostoolkit/chaostoolkit-documentation/tree/master/sources/shared/snippets/tutorials/">code of this tutorial</a> can be found along side this
documentation.</p>
</div>
<h4 id="declare-your-experiment">Declare your experiment<a class="headerlink" href="#declare-your-experiment" title="Permanent link">&para;</a></h4>
<p>Below is the experiment for our hypothesis:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Does our service tolerate the loss of its exchange file?&quot;</span><span class="p">,</span>
    <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Our service reads data from an exchange file, can it support that file disappearing?&quot;</span><span class="p">,</span>
    <span class="nt">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;tutorial&quot;</span><span class="p">,</span>
        <span class="s2">&quot;filesystem&quot;</span>
    <span class="p">],</span>
    <span class="nt">&quot;steady-state-hypothesis&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;The exchange file must exist&quot;</span><span class="p">,</span>
        <span class="nt">&quot;probes&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;probe&quot;</span><span class="p">,</span>
                <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;exchange-file-exists&quot;</span><span class="p">,</span>
                <span class="nt">&quot;tolerance&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
                <span class="nt">&quot;provider&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;python&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;module&quot;</span><span class="p">:</span> <span class="s2">&quot;os.path&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;func&quot;</span><span class="p">:</span> <span class="s2">&quot;exists&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;arguments&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;./exchange.dat&quot;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="nt">&quot;method&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;move-exchange-file&quot;</span><span class="p">,</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;action&quot;</span><span class="p">,</span>
            <span class="nt">&quot;provider&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;python&quot;</span><span class="p">,</span>
                <span class="nt">&quot;module&quot;</span><span class="p">:</span> <span class="s2">&quot;os&quot;</span><span class="p">,</span>
                <span class="nt">&quot;func&quot;</span><span class="p">:</span> <span class="s2">&quot;rename&quot;</span><span class="p">,</span>
                <span class="nt">&quot;arguments&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;src&quot;</span><span class="p">:</span> <span class="s2">&quot;./exchange.dat&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;dst&quot;</span><span class="p">:</span> <span class="s2">&quot;./exchange.dat.old&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;probe&quot;</span><span class="p">,</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;service-is-unavailable&quot;</span><span class="p">,</span>
            <span class="nt">&quot;provider&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;http&quot;</span><span class="p">,</span>
                <span class="nt">&quot;expected_status&quot;</span><span class="p">:</span> <span class="mi">503</span><span class="p">,</span>
                <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://localhost:8080/&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>

<p>Thi experiment shows the bricks of encoding your experiment with Chaos Toolkit.
Once you have provided various metadata, you tell the chaos Toolkit the
activitites it ought to play for us.</p>
<p>Usually we start with a probe that tells us the steady state of our system. In
this case, we simply ensure the exchange file exists. That tells us the
service has its expectation met.</p>
<p>Next, we create the conditions of our hypothesis by pretending our file does not
exist any longer by renaming it.</p>
<p>Finally, we query our service over HTTP and expect a response that does not
indicate the service is unexpectedly broken.</p>
<p>An experiment is made of any numbering of those activities - probes and actions.
Note that an action can also have its own probes for a specific inspection
before and after the action was applied.</p>
<p>The steady probe and the action are implemented by using Python functions while
the last probe performs a HTTP call on your behalf. Please review the
<a href="../../technology/extend/">documentation</a> for other supported implementations.</p>
<h4 id="run-your-experiment">Run your experiment<a class="headerlink" href="#run-your-experiment" title="Permanent link">&para;</a></h4>
<p>To run the experiment, use the <code>chaostoolkit</code> CLI as follows:</p>
<div class="codehilite"><pre><span></span><span class="o">(</span>chaostk<span class="o">)</span> $ chaos --change-dir sources/shared/snippets/tutorials run experiment.json
<span class="o">[</span><span class="m">2017</span>-12-06 <span class="m">16</span>:12:17 INFO<span class="o">]</span> Validating experiment<span class="s1">&#39;s syntax</span>
<span class="s1">[2017-12-06 16:12:17 INFO] Experiment looks valid</span>
<span class="s1">[2017-12-06 16:12:17 INFO] Running experiment: Does our service tolerate the loss of its exchange file?</span>
<span class="s1">[2017-12-06 16:12:17 INFO] Steady state hypothesis: The exchange file must exist</span>
<span class="s1">[2017-12-06 16:12:17 INFO] Probe: exchange-file-exists</span>
<span class="s1">[2017-12-06 16:12:17 INFO]   =&gt; succeeded with &#39;</span>True<span class="s1">&#39;</span>
<span class="s1">[2017-12-06 16:12:17 INFO] Steady state hypothesis is met, we can carry on!</span>
<span class="s1">[2017-12-06 16:12:17 INFO] Action: move-exchange-file</span>
<span class="s1">[2017-12-06 16:12:17 INFO]   =&gt; succeeded without any result value</span>
<span class="s1">[2017-12-06 16:12:17 INFO] Probe: service-is-unavailable</span>
<span class="s1">[2017-12-06 16:12:17 ERROR]    =&gt; failed: A server error occurred.  Please contact the administrator.</span>
<span class="s1">[2017-12-06 16:12:17 INFO] Experiment is now complete. Let&#39;</span>s rollback...
<span class="o">[</span><span class="m">2017</span>-12-06 <span class="m">16</span>:12:17 INFO<span class="o">]</span> No declared rollbacks, let<span class="err">&#39;</span>s move on.
<span class="o">[</span><span class="m">2017</span>-12-06 <span class="m">16</span>:12:17 INFO<span class="o">]</span> Experiment is now completed
</pre></div>

<p>Notice the error towards the end, it tells us the service failed with an
unexpected error.</p>
<p>At this stage, you need to pause and analyse the results of this experiment
to decide what to do next.</p>
<h4 id="fix-your-service">Fix your service<a class="headerlink" href="#fix-your-service" title="Permanent link">&para;</a></h4>
<p>When we ran our service, it broke because the file was not found when read.
Fixing it can take various aspects, we could ensure the file can never be
removed through permissions or locking. Or we could also tolerate such 
failure but let the service return a more appropriate error message in that
case.</p>
<p>This is how we are going to fix it in this tutorial:</p>
<div class="codehilite"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">from</span> <span class="nn">wsgiref.validate</span> <span class="kn">import</span> <span class="n">validator</span>
<span class="kn">from</span> <span class="nn">wsgiref.simple_server</span> <span class="kn">import</span> <span class="n">make_server</span>

<span class="n">EXCHANGE_FILE</span> <span class="o">=</span> <span class="s2">&quot;./exchange.dat&quot;</span>


<span class="k">def</span> <span class="nf">update_exchange_file</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes the current date and time every 10 seconds into the exchange file.</span>

<span class="sd">    The file is created if it does not exist.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Will update to exchange file&quot;</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">EXCHANGE_FILE</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">())</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">simple_app</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read the content of the exchange file and return it.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">EXCHANGE_FILE</span><span class="p">):</span>
        <span class="n">start_response</span><span class="p">(</span>
            <span class="s1">&#39;503 Service Unavailable&#39;</span><span class="p">,</span>
            <span class="p">[(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">)]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="sa">b</span><span class="s1">&#39;Exchange file is not ready&#39;</span><span class="p">]</span>

    <span class="n">start_response</span><span class="p">(</span><span class="s1">&#39;200 OK&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">)])</span>
    <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">EXCHANGE_FILE</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)]</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">update_exchange_file</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="n">httpd</span> <span class="o">=</span> <span class="n">make_server</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">,</span> <span class="n">simple_app</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Listening on port 8080....&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">httpd</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="n">httpd</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
        <span class="n">t</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

<p>The service looks very similar but notice how we check the file indeed exists
before reading it. When it does not exist, we return a more useful 
[503 Service Unavailable][503] error that a consumer could interpret as
&ldquo;try again later&rdquo;.</p>
<p>Note, that we understand a race condition may happen between the time we
checked for the path and the time we read content at that location. We keep
it easy for the benefit of this tutorial.</p>
<h4 id="run-your-experiment-again">Run your experiment again<a class="headerlink" href="#run-your-experiment-again" title="Permanent link">&para;</a></h4>
<p>Let&rsquo;s run again our experiment now that we have fixed and restart our service:</p>
<div class="codehilite"><pre><span></span><span class="o">(</span>chaostk<span class="o">)</span> $ chaos --change-dir sources/shared/snippets/tutorials run experiment.json
<span class="o">[</span><span class="m">2017</span>-12-06 <span class="m">16</span>:12:32 INFO<span class="o">]</span> Validating experiment<span class="s1">&#39;s syntax</span>
<span class="s1">[2017-12-06 16:12:32 INFO] Experiment looks valid</span>
<span class="s1">[2017-12-06 16:12:32 INFO] Running experiment: Does our service tolerate the loss of its exchange file?</span>
<span class="s1">[2017-12-06 16:12:32 INFO] Steady state hypothesis: The exchange file must exist</span>
<span class="s1">[2017-12-06 16:12:32 INFO] Probe: exchange-file-exists</span>
<span class="s1">[2017-12-06 16:12:32 INFO]   =&gt; succeeded with &#39;</span>True<span class="s1">&#39;</span>
<span class="s1">[2017-12-06 16:12:32 INFO] Steady state hypothesis is met, we can carry on!</span>
<span class="s1">[2017-12-06 16:12:32 INFO] Action: move-exchange-file</span>
<span class="s1">[2017-12-06 16:12:32 INFO]   =&gt; succeeded without any result value</span>
<span class="s1">[2017-12-06 16:12:32 INFO] Probe: service-is-unavailable</span>
<span class="s1">[2017-12-06 16:12:32 INFO]   =&gt; succeeded with &#39;</span>Exchange file is not ready<span class="s1">&#39;</span>
<span class="s1">[2017-12-06 16:12:32 INFO] Experiment is now complete. Let&#39;</span>s rollback...
<span class="o">[</span><span class="m">2017</span>-12-06 <span class="m">16</span>:12:32 INFO<span class="o">]</span> No declared rollbacks, let<span class="err">&#39;</span>s move on.
<span class="o">[</span><span class="m">2017</span>-12-06 <span class="m">16</span>:12:32 INFO<span class="o">]</span> Experiment is now completed
</pre></div>

<p>Notice the error towards the end, it tells us the service failed still but now
we get the error we designed our service for.</p>
<h4 id="go-further">Go further<a class="headerlink" href="#go-further" title="Permanent link">&para;</a></h4>
<p>In this tutorial, you first approached the Chaos Toolkit to apply experiments
against your system to confirm or infirm your initial hypothesis.</p>
<p>The example is basic on purpose but shows the simplicity of exercising
the <a href="http://principlesofchaos.org/">chaos engineering principles</a> to learn and adapt your system.</p>
<p>The Chaos Toolkit does not limit itself to local use-cases like this one and
offers the possibility to interact with any system through remote API calls.</p>
<p>Please <a href="https://join.chaostoolkit.org/">join us</a> on the Chaos Toolkit community to continue your
exploration.</p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../running/" title="Run" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Run
              </span>
            </div>
          </a>
        
        
          <a href="../latest/" title="Latest Release" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Latest Release
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            &copy; 2017 chaostoolkit team
          </div>
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://github.com/chaostoolkit" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/chaostoolkit" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://join.chaostoolkit.org/" class="md-footer-social__link fa fa-slack"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.6cdc17f0.js"></script>
      
      <script>app.initialize({version:"0.17.2",url:{base:"../.."}})</script>
      
    
    
      
        <script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","UA-107338053-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})});var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})</script>
      
    
  </body>
</html>